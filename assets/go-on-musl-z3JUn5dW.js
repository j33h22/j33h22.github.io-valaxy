import{_ as p}from"./ValaxyMain.vue_vue_type_style_index_0_lang-jTyeBMPI.js";import{_ as u,a as d,p as h,o as m,c as g,w as e,f as l,g as s,h as a,r as n,i as _}from"./app-TBqKw1R4.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-_p5_SAsP.js";import"./YunCard.vue_vue_type_script_setup_true_lang-HibbEtMS.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-QTqAMj2a.js";import"./index-nlSmcLJj.js";const r=JSON.parse('{"title":"关于 Golang 二进制文件在 musl 作为 主要 libc 的 Linux 发行版的适配记录","description":"","frontmatter":{"layout":"post","title":"关于 Golang 二进制文件在 musl 作为 主要 libc 的 Linux 发行版的适配记录","date":"2024-01-28T02:14:55.000Z"},"headers":[{"level":2,"title":"CGO 是什么？","slug":"cgo-是什么","link":"#cgo-是什么","children":[]},{"level":2,"title":"我的项目用到了C","slug":"我的项目用到了c","link":"#我的项目用到了c","children":[]},{"level":2,"title":"我的项目没有用到C","slug":"我的项目没有用到c","link":"#我的项目没有用到c","children":[{"level":3,"title":"如果你是在普通的终端中","slug":"如果你是在普通的终端中","link":"#如果你是在普通的终端中","children":[]},{"level":3,"title":"如果你是在 Github Actions 中","slug":"如果你是在-github-actions-中","link":"#如果你是在-github-actions-中","children":[]}]}],"relativePath":"pages/posts/go-on-musl.md","path":"/home/runner/work/j33h22.github.io/j33h22.github.io/pages/posts/go-on-musl.md","lastUpdated":1706380671000}'),f={name:"pages/posts/go-on-musl.md",data(){return{data:r,frontmatter:r.frontmatter,$frontmatter:r.frontmatter}},setup(){const o=d();o.meta.frontmatter=Object.assign(o.meta.frontmatter||{},r.frontmatter||{}),h("pageData",r)}},b={id:"前言",tabindex:"-1"},C=l("p",null,"首先我自己没有对 Golang 很深了解，一切都在学习中，不过还好目前为止学习得还算顺利，毕竟写的都是人话。",-1),E=l("p",null,"在本文章中我不会去锐评有关 musl 的东西，毕竟我不会C，没啥资格聊这个。",-1),y={id:"正文",tabindex:"-1"},k=l("p",null,[s("像 Alpine Linux 一样使用 musl 的发行版其实很多，我自认为用的人比较多的发行版例如 OpenWrt 和 Gentoo，所以"),l("strong",null,"能"),s("解决这个问题的话还是有必要的。")],-1),G={id:"cgo-是什么",tabindex:"-1"},v=l("p",null,"估计很多刚学 Go 的人和我一样很懵，虽然没啥人简短总结，不过算是找到了个比较简短的解释。",-1),F={id:"我的项目用到了c",tabindex:"-1"},B=l("p",null,"我自己还没学完 Golang，所以我让 GPT-3.5 给了个回答。",-1),A=l("blockquote",null,[l("p",null,"在使用 musl 作为 C 标准库的 Linux 发行版中，可能会出现与 glibc 不同的问题，尤其是在涉及到 C 语言代码的 Go 项目中。以下是一些建议和解决方案："),l("ol",null,[l("li",null,[l("p",null,[l("strong",null,"交叉编译："),s(" 一个通用的方法是在开发环境中使用 glibc，但在部署目标系统上使用 musl。这可以通过交叉编译来实现。在构建 Go 项目时，可以通过设置环境变量 "),l("code",null,"CC"),s(" 来指定使用的 C 编译器。例如：")]),l("div",{class:"language-bash"},[l("button",{title:"Copy Code",class:"copy"}),l("span",{class:"lang"},"bash"),l("pre",{class:"shiki github-dark vp-code-dark"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#E1E4E8"}},"CC"),l("span",{style:{color:"#F97583"}},"="),l("span",{style:{color:"#9ECBFF"}},"musl-gcc"),l("span",{style:{color:"#E1E4E8"}}," "),l("span",{style:{color:"#B392F0"}},"go"),l("span",{style:{color:"#E1E4E8"}}," "),l("span",{style:{color:"#9ECBFF"}},"build")])])]),l("pre",{class:"shiki github-light vp-code-light"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#24292E"}},"CC"),l("span",{style:{color:"#D73A49"}},"="),l("span",{style:{color:"#032F62"}},"musl-gcc"),l("span",{style:{color:"#24292E"}}," "),l("span",{style:{color:"#6F42C1"}},"go"),l("span",{style:{color:"#24292E"}}," "),l("span",{style:{color:"#032F62"}},"build")])])]),l("button",{class:"collapse"})]),l("p",null,"这将使用 musl-gcc 编译器来构建你的 Go 项目，确保 musl 库被链接到二进制文件中。")]),l("li",null,[l("p",null,[l("strong",null,"静态链接："),s(" 如果交叉编译并不适用，考虑将 C 代码静态链接到 Go 二进制文件中。这样，你可以在目标系统上运行 Go 二进制文件而不必依赖目标系统上的 C 库。可以通过设置 "),l("code",null,"CGO_ENABLED"),s(" 环境变量为 "),l("code",null,"0"),s(" 来禁用 CGO，并使用 "),l("code",null,"-ldflags"),s(" 标志将 C 代码静态链接到 Go 二进制文件中。例如：")]),l("div",{class:"language-bash"},[l("button",{title:"Copy Code",class:"copy"}),l("span",{class:"lang"},"bash"),l("pre",{class:"shiki github-dark vp-code-dark"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#E1E4E8"}},"CGO_ENABLED"),l("span",{style:{color:"#F97583"}},"="),l("span",{style:{color:"#79B8FF"}},"0"),l("span",{style:{color:"#E1E4E8"}}," "),l("span",{style:{color:"#B392F0"}},"go"),l("span",{style:{color:"#E1E4E8"}}," "),l("span",{style:{color:"#9ECBFF"}},"build"),l("span",{style:{color:"#E1E4E8"}}," "),l("span",{style:{color:"#79B8FF"}},"-ldflags="),l("span",{style:{color:"#9ECBFF"}},'"-linkmode external -extldflags -static"')])])]),l("pre",{class:"shiki github-light vp-code-light"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#24292E"}},"CGO_ENABLED"),l("span",{style:{color:"#D73A49"}},"="),l("span",{style:{color:"#005CC5"}},"0"),l("span",{style:{color:"#24292E"}}," "),l("span",{style:{color:"#6F42C1"}},"go"),l("span",{style:{color:"#24292E"}}," "),l("span",{style:{color:"#032F62"}},"build"),l("span",{style:{color:"#24292E"}}," "),l("span",{style:{color:"#005CC5"}},"-ldflags="),l("span",{style:{color:"#032F62"}},'"-linkmode external -extldflags -static"')])])]),l("button",{class:"collapse"})]),l("p",null,"这会禁用 CGO 并在构建时将 C 代码静态链接到 Go 二进制文件中。")]),l("li",null,[l("p",null,[l("strong",null,"使用正确的编译器和工具链："),s(" 确保在目标系统上使用正确的编译器和工具链。如果目标系统使用 musl，确保在目标系统上安装了 musl 工具链和库。")])]),l("li",null,[l("p",null,[l("strong",null,"检查依赖库的兼容性："),s(" 如果你的项目依赖于其他库，确保这些库与 musl 兼容。有些库可能依赖于特定于 glibc 的特性，因此在 musl 系统上可能会遇到问题。")])]),l("li",null,[l("p",null,[l("strong",null,"查看错误日志："),s(" 如果你遇到问题，查看错误日志并检查特定于 musl 的问题。这可能包括一些系统调用的不同行为或缺失的功能。")])])]),l("p",null,"请注意，这些建议可能需要根据你的具体情况进行调整。在处理与 musl 兼容性问题时，了解 musl 的特性和与 glibc 的差异是很重要的。"),l("p",null,"—— ChatGPT 3.5")],-1),O={id:"我的项目没有用到c",tabindex:"-1"},$=l("p",null,"如果你的项目中没有用到C的话，其实是可以关掉的，关掉也是最简单的解决方法。",-1),D=l("p",null,"很简单，在编译的时候加个环境变量关掉 CGO 就好了。",-1),x={id:"如果你是在普通的终端中",tabindex:"-1"},L=l("p",null,[s("写到底层环境变量中（如 "),l("code",null,"/etc/enviroment"),s(" 或 "),l("code",null,"~/.bashrc"),s("）或每次新建终端时输入：")],-1),N=l("div",{class:"language-bash"},[l("button",{title:"Copy Code",class:"copy"}),l("span",{class:"lang"},"bash"),l("pre",{class:"shiki github-dark vp-code-dark"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#F97583"}},"export"),l("span",{style:{color:"#E1E4E8"}}," CGO_ENABLED"),l("span",{style:{color:"#F97583"}},"="),l("span",{style:{color:"#79B8FF"}},"0")])])]),l("pre",{class:"shiki github-light vp-code-light"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#D73A49"}},"export"),l("span",{style:{color:"#24292E"}}," CGO_ENABLED"),l("span",{style:{color:"#D73A49"}},"="),l("span",{style:{color:"#005CC5"}},"0")])])]),l("button",{class:"collapse"})],-1),P={id:"如果你是在-github-actions-中",tabindex:"-1"},w=l("p",null,[s("在 "),l("code",null,"env"),s(" 中加入：")],-1),T=l("div",{class:"language-yaml"},[l("button",{title:"Copy Code",class:"copy"}),l("span",{class:"lang"},"yaml"),l("pre",{class:"shiki github-dark vp-code-dark"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#85E89D"}},"env"),l("span",{style:{color:"#E1E4E8"}},":")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#E1E4E8"}},"     "),l("span",{style:{color:"#85E89D"}},"CGO_ENABLED"),l("span",{style:{color:"#E1E4E8"}},": "),l("span",{style:{color:"#79B8FF"}},"0")])])]),l("pre",{class:"shiki github-light vp-code-light"},[l("code",null,[l("span",{class:"line"},[l("span",{style:{color:"#22863A"}},"env"),l("span",{style:{color:"#24292E"}},":")]),s(`
`),l("span",{class:"line"},[l("span",{style:{color:"#24292E"}},"     "),l("span",{style:{color:"#22863A"}},"CGO_ENABLED"),l("span",{style:{color:"#24292E"}},": "),l("span",{style:{color:"#005CC5"}},"0")])])]),l("button",{class:"collapse"})],-1),V={id:"结尾",tabindex:"-1"},j=l("p",null,"总的来说问题就是这样解决的了，有啥不对欢迎大佬在评论区补充。",-1);function M(o,q,z,S,c,J){const t=_,i=p;return m(),g(i,{frontmatter:c.frontmatter,data:c.data},{"main-content-md":e(()=>[l("h1",b,[s("前言 "),a(t,{class:"header-anchor",href:"#前言","aria-label":'Permalink to "前言"'},{default:e(()=>[s("​")]),_:1})]),C,E,l("h1",y,[s("正文 "),a(t,{class:"header-anchor",href:"#正文","aria-label":'Permalink to "正文"'},{default:e(()=>[s("​")]),_:1})]),l("p",null,[s("这次的适配记录的起因是因为我的 "),a(t,{href:"https://github.com/QingNetwork/tpclash/",target:"_blank",rel:"noreferrer"},{default:e(()=>[s("复活版TPClash")]),_:1}),s(" 项目群中有用户反馈 Alpine Linux 无法正常运行，后面想了想 Alpine Linux 是使用 "),a(t,{href:"https://zh.wikipedia.org/wiki/Musl",target:"_blank",rel:"noreferrer"},{default:e(()=>[s("musl")]),_:1}),s(" 作为 "),a(t,{href:"https://zh.wikipedia.org/wiki/C%E6%A8%99%E6%BA%96%E5%87%BD%E5%BC%8F%E5%BA%AB",target:"_blank",rel:"noreferrer"},{default:e(()=>[s("C标准函式库(libc)")]),_:1}),s(" 的，这么一想起不来也正常了")]),k,l("h2",G,[s("CGO 是什么？ "),a(t,{class:"header-anchor",href:"#cgo-是什么","aria-label":'Permalink to "CGO 是什么？"'},{default:e(()=>[s("​")]),_:1})]),v,l("blockquote",null,[l("p",null,[s("Go 作为当下最火的开发语言之一，它的优势不必多说。Go 对于高并发的支持，使得它可以很方便的作为独立模块嵌入业务系统。有鉴于我司大量的 C/C++存量代码，如何 将 Go 和 C/C++进行打通就尤为重要。**Golang 自带的 CGO 可以支持与 C 语言接口的互通。**本文首先介绍了 cgo 的常见用法，然后根据底层"),a(t,{href:"https://cloud.tencent.com/product/tcap?from_column=20065&from=20065",target:"_blank",rel:"noreferrer"},{default:e(()=>[s("代码分析")]),_:1}),s("其实现机制，最后在特定场景下进行 cgo 实践。")]),l("p",null,[s("来源："),a(t,{href:"https://cloud.tencent.com/developer/article/1786332",target:"_blank",rel:"noreferrer"},{default:e(()=>[s("Go与C的桥梁：CGO入门剖析与实践")]),_:1})])]),l("h2",F,[s("我的项目用到了C "),a(t,{class:"header-anchor",href:"#我的项目用到了c","aria-label":'Permalink to "我的项目用到了C"'},{default:e(()=>[s("​")]),_:1})]),B,A,l("h2",O,[s("我的项目没有用到C "),a(t,{class:"header-anchor",href:"#我的项目没有用到c","aria-label":'Permalink to "我的项目没有用到C"'},{default:e(()=>[s("​")]),_:1})]),$,D,l("h3",x,[s("如果你是在普通的终端中 "),a(t,{class:"header-anchor",href:"#如果你是在普通的终端中","aria-label":'Permalink to "如果你是在普通的终端中"'},{default:e(()=>[s("​")]),_:1})]),L,N,l("h3",P,[s("如果你是在 Github Actions 中 "),a(t,{class:"header-anchor",href:"#如果你是在-github-actions-中","aria-label":'Permalink to "如果你是在 Github Actions 中"'},{default:e(()=>[s("​")]),_:1})]),w,T,l("h1",V,[s("结尾 "),a(t,{class:"header-anchor",href:"#结尾","aria-label":'Permalink to "结尾"'},{default:e(()=>[s("​")]),_:1})]),j]),"main-header":e(()=>[n(o.$slots,"main-header")]),"main-header-after":e(()=>[n(o.$slots,"main-header-after")]),"main-nav":e(()=>[n(o.$slots,"main-nav")]),"main-content":e(()=>[n(o.$slots,"main-content")]),"main-content-after":e(()=>[n(o.$slots,"main-content-after")]),"main-nav-before":e(()=>[n(o.$slots,"main-nav-before")]),"main-nav-after":e(()=>[n(o.$slots,"main-nav-after")]),comment:e(()=>[n(o.$slots,"comment")]),footer:e(()=>[n(o.$slots,"footer")]),aside:e(()=>[n(o.$slots,"aside")]),"aside-custom":e(()=>[n(o.$slots,"aside-custom")]),default:e(()=>[n(o.$slots,"default")]),_:3},8,["frontmatter","data"])}const I=u(f,[["render",M]]);export{r as data,I as default};
